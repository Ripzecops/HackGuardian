<?php
require_once __DIR__ . '/../models/Task.php';
require_once __DIR__ . '/../models/User.php';
require_once __DIR__ . '/AuthController.php';

class PentesterController {
    private $taskModel;
    private $userModel;
    private $auth;

    public function __construct() {
        $this->taskModel = new Task();
        $this->userModel = new User();
        $this->auth = new AuthController();
    }

    // Pentester dashboard
    public function dashboard() {
        $this->auth->checkAuth();
        $this->auth->checkRole(['pentester']);
        
        $tasks = $this->taskModel->getAll();
        
        require_once __DIR__ . '/../views/pentester/dashboard.php';
    }

    // Create task
    public function createTask() {
        $this->auth->checkAuth();
        $this->auth->checkRole(['pentester']);
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $title = $_POST['title'];
            $description = $_POST['description'];
            $assigned_to = $_POST['assigned_to'];
            $assigned_by = $_SESSION['user_id'];
            
            if ($this->taskModel->create($title, $description, $assigned_to, $assigned_by)) {
                $success = "Task created successfully!";
            } else {
                $error = "Failed to create task!";
            }
        }
        
        // Get all hackers to assign tasks
        $hackers = $this->userModel->getByRole('hacker');
        require_once __DIR__ . '/../views/pentester/create_task.php';
    }
}
?>